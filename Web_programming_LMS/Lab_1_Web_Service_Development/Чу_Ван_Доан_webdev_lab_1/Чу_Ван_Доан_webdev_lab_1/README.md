
# Проект Чат на FastAPI с использованием WebSocket, PostgreSQL и Docker

## Описание проекта
Этот проект представляет собой веб-приложение для создания и использования комнат чата, разработанное на основе **FastAPI** для RESTful API и **WebSocket** для поддержки общения в реальном времени. Данные пользователей, сообщений и комнат хранятся в базе данных **PostgreSQL**. Приложение развернуто с использованием **Docker** и **Docker Compose** для упрощения установки и конфигурации.

## Функциональность
1. **Регистрация и аутентификация пользователей**
   - Регистрация пользователей с использованием email, имени пользователя и пароля.
   - Аутентификация пользователей с использованием токенов JWT.
   
2. **Управление комнатами чата**
   - Создание, поиск и удаление комнат (для владельцев комнат).
   - Подключение к комнатам для отправки и получения сообщений в режиме реального времени.

3. **Обмен сообщениями в реальном времени**
   - Пользователи могут обмениваться сообщениями внутри комнаты, и все участники комнаты видят сообщения сразу же.
   - Подключение и отключение пользователей отображается в комнате.

## Стек технологий
- **Backend**: FastAPI, WebSocket, SQLAlchemy
- **Frontend**: HTML, Jinja2, JavaScript
- **База данных**: PostgreSQL
- **DevOps**: Docker, Docker Compose, Nginx (reverse proxy)

---

## Установка и запуск проекта

### Предварительные требования
Для запуска этого проекта необходимо установить:
- **Docker** и **Docker Compose**
- **Git** для клонирования репозитория

### Шаги для запуска
1. **Клонирование репозитория**
   ```bash
   git clone <ссылка на ваш репозиторий>
   cd <название проекта>
   ```

2. **Настройка переменных окружения**
   Создайте файл `.env` в корне проекта с переменными для подключения к базе данных, секретными ключами и конфигурациями Docker:
   ```env
   POSTGRES_USER=your_username
   POSTGRES_PASSWORD=your_password
   POSTGRES_DB=your_database_name
   SECRET_KEY=your_secret_key
   ```

3. **Запуск Docker Compose**
   Выполните команду для создания и запуска всех контейнеров:
   ```bash
   docker-compose up --build
   ```
   Это создаст и запустит контейнеры для приложения (FastAPI), базы данных (PostgreSQL) и прокси-сервера (Nginx).

4. **Открытие приложения**
   После запуска приложения перейдите в браузер и откройте:
   ```
   http://localhost
   ```
5. **Отключение службы Docker Compose**
   ```bash
   docker-compose down -v
   ```
---

## Структура проекта

```plaintext
project-root/
├── .gitignore                  # Исключение файлов/папок, которые не нужно отправлять в репозиторий Git
├── .dockerignore               # Исключение файлов/папок, которые не нужны для сборки Docker-образа
├── docker-compose.yml          # Конфигурация Docker Compose для всего проекта
│
├── website/                    # Микросервис для управления пользователями и чат-комнатами
│   ├── app/
│   │   ├── main.py             # Точка входа для приложения website
│   │   ├── database.py         # Настройка подключения к PostgreSQL и ORM
│   │   ├── models.py           # Модели для пользователей и чат-комнат
│   │   ├── schemas.py          # Схемы для ввода/вывода данных
│   │   ├── routers/            # Роуты для сайта
│   │   │   ├── auth.py         # Регистрация и аутентификация пользователей
│   │   │   ├── chat.py         # Управление чат-комнатами (создание, поиск)
|   |   |   └── websocket_handler.py # Обработчик для WebSocket-соединений
│   │   ├── templates/          # HTML-шаблоны, использующие Jinja2
│   │   │   ├── index.html      # Шаблон для главной страницы
|   |   |   ├── chat.html       # Шаблон для списка комнат
|   |   |   ├── login.html      # Шаблон для страницы входа
|   |   |   ├── register.html   # Шаблон для страницы регистрации
|   |   |   └── room_chat.html  # Шаблон для страницы комнаты чата
│   │   └── static/             
|   |       └── favicon.ico     # Иконка для сайта
│   ├── Dockerfile              # Dockerfile для сервиса website
│   ├── requirements.txt        # Список зависимостей для сервиса website
|   └── .gitignore              # Исключение файлов для сервиса website
│
├── chat/                       # Микросервис WebSocket для работы с чатами
│   ├── app/
│   │   ├── main.py             # Точка входа для WebSocket-сервера
│   │   └── websocket_handler.py # Обработчик событий WebSocket
│   ├── Dockerfile              # Dockerfile для сервиса chat
│   └── requirements.txt        # Список зависимостей для сервиса chat
│
├── db/                         # Конфигурация для базы данных PostgreSQL
|   ├── dump/                   # Каталог для сохранения данных
│   ├── Dockerfile              # Dockerfile для PostgreSQL
│   └── init.sql                # Структура таблиц и начальные данные
│
└── nginx/                      # Конфигурация для Nginx
    ├── nginx.conf              # Конфигурация для reverse proxy для website и chat
    └── Dockerfile              # Dockerfile для Nginx

```

---

## API и Endpoints

### Пользовательская аутентификация
- `POST /register` - Регистрация нового пользователя
- `POST /login` - Аутентификация пользователя с использованием JWT
- `GET /chat` - Основной экран чата после авторизации

### Комнаты чата
- `POST /create-room` - Создание новой комнаты
- `POST /delete-room` - Удаление комнаты (доступно только владельцу комнаты)
- `GET /search-rooms?search_query=<query>` - Поиск комнат по имени

### Сообщения и WebSocket
- `GET /ws/<room_name>` - Подключение к комнате по WebSocket для обмена сообщениями в реальном времени
  - Сообщение отправляется как обычный текст; другие участники комнаты сразу же видят новое сообщение.


---

## Заключение
Этот проект продемонстрировал создание многокомпонентного веб-приложения с использованием современных технологий, таких как FastAPI, WebSocket, PostgreSQL и Docker. Реализация помогла закрепить навыки работы с микросервисной архитектурой, сетевыми протоколами и асинхронным программированием. Проект дает представление о важности организации структуры приложения и позволяет изучить возможности развертывания приложений с поддержкой масштабируемого взаимодействия в реальном времени.

## Ресурсы и ссылки
- **FastAPI**: [https://fastapi.tiangolo.com/](https://fastapi.tiangolo.com/)
- **Документация WebSocket**: [https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API)
- **Docker**: [https://docs.docker.com/](https://docs.docker.com/)
- **PostgreSQL**: [https://www.postgresql.org/docs/](https://www.postgresql.org/docs/)
- **Nginx**: [https://nginx.org/en/docs/](https://nginx.org/en/docs/)
